<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
  
  <!-- Meta esenciales primero -->
  <title>Anmago Store - Ropa, Hogar, Belleza y m√°s</title>
  <meta name="description" content="Encuentra ropa, relojer√≠a, hogar, belleza y m√°s en Anmago Store. Los mejores precios y calidad garantizada.">
  <meta name="google-site-verification" content="ea0VJL7XRbgbPwBex-V1Z2JeuebSdELH2lSUw2BkAxw" />
  
  <!-- ‚ö° OPTIMIZACIONES CR√çTICAS PARA LCP -->
   <link rel="icon" href="tina-192.png" type="image/x-icon" />
  <!-- 1. Precarga del LOGO (elemento LCP m√°s probable) -->
  <link rel="preload" 
        href="https://ik.imagekit.io/mbsk9dati/logo.jpg?tr=w-48,h-48,f-auto" 
        as="image" 
        fetchpriority="high">
  
  <!-- 2. Conexiones tempranas para CDNs cr√≠ticas -->
  <link rel="preconnect" href="https://ik.imagekit.io" crossorigin>
  <link rel="dns-prefetch" href="https://ik.imagekit.io">
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
  
  <!-- CSS CR√çTICO INLINE (SOLO LO NECESARIO) -->
  <style>
    /* SOLO ESTILOS PARA PRIMER RENDER - 2KB m√°ximo */
    .header-sticky {
      background: linear-gradient(135deg, #1B4557, #2A6A8F);
      color: white;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1030;
      height: 70px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    /* ESPACIO PARA HEADER FIJADO */
    body { padding-top: 70px; background-color: #f8f9fa; margin: 0; }
    
    /* SKELETON LOADING B√ÅSICO */
    .skeleton {
      background: #f0f0f0;
      border-radius: 8px;
      animation: pulse 1.5s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    /* ARREGLOS PARA CLS (ELIMINAR SALTOS) */
    /* 1. CARRUSEL FIJO - EVITA EL MAYOR SALTO */
    .carousel-promos-home {
      height: 400px; /* Altura fija para reservar espacio */
      min-height: 400px;
      overflow: hidden;
      position: relative;
    }
    
    .carousel-promos-home .carousel-inner {
      height: 100%;
    }
    
    .carousel-promos-home .carousel-item {
      height: 100%;
      padding: 10px 0;
    }
    
    /* 2. BOT√ìN VOLVER AL INICIO - POSICI√ìN FIJA */
    .btn-volver-inicio {
      position: fixed;
      top: 80px;
      left: 10px;
      z-index: 1000;
      width: 40px;
      height: 40px;
      background: white;
      border: 1px solid #d1d9e6;
      border-radius: 50%;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      color: #0b7021;
      transition: all 0.3s ease;
    }
    
    .btn-volver-inicio:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0, 0, 0, 0.12);
    }
    
    /* RESPONSIVE B√ÅSICO */
    @media (max-width: 768px) {
      .header-sticky { height: 60px; }
      body { padding-top: 60px; }
      .carousel-promos-home {
        height: 350px;
        min-height: 350px;
      }
      .btn-volver-inicio {
        top: 70px;
        left: 8px;
        width: 36px;
        height: 36px;
      }
    }
  </style>
  
  <!-- PWA y favicon -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="https://ik.imagekit.io/mbsk9dati/logo.jpg?tr=w-560,q-80" type="image/x-icon" />
  
  <!-- CSS EXTERNO CARGADO AS√çNCRONAMENTE -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" media="print" onload="this.media='all'">
  <link rel="stylesheet" href="ESTILO.CSS?v=20251116" media="print" onload="this.media='all'">
  
  <!-- FALLBACK PARA NAVEGADORES SIN JS -->
  <noscript>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="ESTILO.CSS?v=20251116">
  </noscript>
</head>
<body class="bg-light">
  <!-- HEADER COMPLETO (IGUAL) -->
  <header class="header-sticky d-flex justify-content-between align-items-center px-3 py-2">
    <!-- LOGO CON PRIORIDAD ALTA -->
    <div class="logo">
      <a href="#" onclick="volverAInicio(); event.preventDefault(); event.stopPropagation(); return false;">
       <img src="https://ik.imagekit.io/mbsk9dati/logo.jpg?tr=w-48,h-48,f-auto"
     alt="Logo ANMAGO"
     width="48"
     height="48">
      </a>
    </div>

    <!-- BUSCADOR EN HEADER -->
    <div class="flex-grow-1 mx-3 position-relative" style="max-width: 500px;">
      <input id="buscador" class="form-control buscador-header" 
             placeholder="Buscar productos..." 
             autocomplete="off">
      <div id="sugerencias" class="sugerencias-container"></div>
    </div>

    <!-- BOT√ìN HAMBURGUESA -->
    <button class="navbar-toggler border-0 bg-transparent" type="button"
            data-bs-toggle="offcanvas"
            data-bs-target="#menuLateral"
            aria-controls="menuLateral"
            aria-label="Abrir men√∫">
      <i class="bi bi-list fs-1 text-white"></i>
    </button>
  </header>

  <!-- MEN√ö LATERAL COMPLETO -->
  <div class="offcanvas offcanvas-start" tabindex="-1" id="menuLateral" aria-labelledby="menuLateralLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="menuLateralLabel">
        <img src="https://ik.imagekit.io/mbsk9dati/logo.jpg?tr=w-48,h-48"
     alt="Logo ANMAGO"
     width="48"
     height="48">
        Anmago Store
      </h5>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>

    <div class="offcanvas-body d-flex flex-column gap-3">
      <!-- Inicio -->
      <a href="#" class="nav-link d-flex align-items-center" onclick="volverAInicio(); cerrarMenu(); return false;">
        <i class="bi bi-house me-2"></i> Inicio
      </a>

      <!-- Promociones -->
      <a href="PROMOS.HTML" class="nav-link d-flex align-items-center" onclick="cerrarMenu();">
        <i class="bi bi-percent me-2"></i> Promociones
      </a>

      <!-- Todos los productos -->
      <a href="#" class="nav-link d-flex align-items-center" onclick="mostrarTodosLosProductosCompleto(); cerrarMenu(); return false;">
        <i class="bi bi-grid-3x3 me-2"></i> Todos los productos
      </a>

      <!-- CATEGOR√çAS DIN√ÅMICAS - SIMPLIFICADO -->
      <div id="menu-categorias-dinamico" class="mt-2">
        <p class="small text-muted mb-2"><i class="bi bi-list-ul me-1"></i> Categor√≠as principales</p>
        
        <!-- Se cargar√°n din√°micamente -->
        <div class="text-center py-3">
          <div class="spinner-border spinner-border-sm text-primary"></div>
          <p class="mt-2 small text-muted">Cargando categor√≠as...</p>
        </div>
      </div>

      <!-- Contacto -->
      <a href="modalformulario.html" 
         class="nav-link d-flex align-items-center" onclick="cerrarMenu();">
        <i class="bi bi-person me-2"></i> Mi cuenta
      </a>

      <!-- WhatsApp -->
      <a href="https://wa.me/573006498710?text=¬°Hola!%20Me%20interesan%20sus%20productos%20de%20Anmago%20Store" 
         target="_blank"
         class="nav-link d-flex align-items-center text-success" onclick="cerrarMenu();">
        <i class="bi bi-whatsapp me-2"></i> WhatsApp
      </a>

      <!-- Contacto formulario -->
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSevvlCBgz7L6l2-DecKQLazoswqzf7DRYWOaCq4FtMGOR6D2Q/viewform?usp=header"
         target="_blank"
         class="nav-link d-flex align-items-center" onclick="cerrarMenu();">
        <i class="bi bi-envelope me-2"></i> Contacto
      </a>
    </div>

    <div class="offcanvas-footer border-top p-3">
      <div class="text-center small text-muted">
        <p class="mb-1">anmagostore@gmail.com</p>
        <p class="mb-0">3006498710 - 3115046741</p>
      </div>
    </div>
  </div>

  <!-- BOT√ìN VOLVER AL INICIO (Solo desktop) -->
  <a href="index.html" class="btn-volver-inicio d-none d-md-flex"
   data-bs-toggle="tooltip" data-bs-placement="right" data-bs-title="Volver al inicio">
    <i class="bi bi-house-door-fill" style="font-size: 1.3rem;"></i>
  </a>

  <!-- CATEGOR√çAS R√ÅPIDAS DIN√ÅMICAS -->
  <div class="container-fluid mt-3">
    <div class="categorias-rapidas" id="categorias-rapidas">
      <!-- Se carga din√°micamente -->
      <div class="text-center py-2">
        <div class="spinner-border spinner-border-sm text-primary"></div>
        <small class="text-muted ms-2">Cargando categor√≠as...</small>
      </div>
    </div>
  </div>

<!-- BANNER INSTITUCIONAL -->
<div class="container-fluid banner-promocional py-2" style="background-color:#f5f5f5;">
  <div class="container text-center" style="font-family:'Segoe UI', sans-serif; font-weight:500; font-size:14px; color:#333;">
    <div>
      <span style="color:#c49b0b;">Nuestros precios incluyen env√≠o est√°ndar en la mayor√≠a de ciudades.</span><br>
      <span style="color:#c49b0b;">Si tu zona tiene tarifa especial, te lo informamos antes de pagar.</span>
    </div>
    <div style="color:#c49b0b;">
      Los mejores precios ¬∑ Calidad garantizada ¬∑ Env√≠os Nacionales Contraentrega
    </div>
  </div>
</div>


  <!-- BOT√ìN INSTALAR APP -->
  <div id="instalar-container" class="instalar-container d-none">
    <button id="boton-instalar" class="btn-instalar-app">
      <i class="bi bi-download"></i> Instalar App
    </button>
  </div>

  <!-- ‚úÖ SISTEMA DE VISTAS DIN√ÅMICAS -->
  <main>
    <!-- VISTA 1: INICIO (HOME) -->
    <div id="vista-inicio" class="vista vista-activa">
      <!-- BOT√ìN PROMOCIONES -->
      <div class="container text-center mt-3">
        <a href="PROMOS.HTML" class="btn btn-warning fw-bold px-4 py-2 rounded-pill">
          üéÅ Ver Todas las Ofertas
        </a>
      </div>

      <!-- CARRUSEL DE PROMOCIONES CON ALTURA FIJA -->
      <div class="container mt-3">
        <div class="carrusel-temporizador mb-2">
          <i class="bi bi-clock"></i>
          <span id="temporizador-home" class="fw-bold ms-1">Cargando promociones...</span>
        </div>
        
        <div id="carouselPromosHome" class="carousel slide carousel-promos-home" data-bs-ride="carousel">
          <div class="carousel-inner" id="carousel-promos-home-contenido">
            <div class="carousel-item active">
              <div class="text-center py-4">
                <div class="spinner-border text-primary"></div>
                <p class="mt-2 text-muted">Cargando ofertas...</p>
              </div>
            </div>
          </div>
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselPromosHome" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Anterior</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselPromosHome" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Siguiente</span>
          </button>
        </div>
        
        <div class="text-center mt-2">
          <small class="text-muted">Desliza para ver m√°s ofertas</small>
        </div>
      </div>

      <!-- √öLTIMOS PRODUCTOS -->
      <div class="container mt-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h2 class="h4 fw-bold mb-0">üÜï Productos reci√©n llegados</h2>
          <a href="#" onclick="mostrarTodosLosProductos(); return false;" class="btn btn-link btn-sm">
            Ver todos <i class="bi bi-arrow-right"></i>
          </a>
        </div>
        <div id="grid-ultimos" class="grid-productos-ml">
          <div class="card-producto-ml skeleton" style="height: 280px;"></div>
          <div class="card-producto-ml skeleton" style="height: 280px;"></div>
          <div class="card-producto-ml skeleton" style="height: 280px;"></div>
          <div class="card-producto-ml skeleton" style="height: 280px;"></div>
        </div>
      </div>
    </div>

    <!-- VISTA 2: SUBTIPOS -->
    <div id="vista-subtipos" class="vista">
      <div class="container mt-3">
        <nav class="breadcrumb-vista">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="#" onclick="volverAInicio(); return false;">INICIO</a></li>
            <li class="breadcrumb-item active" id="breadcrumb-tipo"></li>
          </ol>
        </nav>
        
        <h1 class="h4 fw-bold mb-3" id="titulo-subtipos">Subtipos</h1>
        <div id="grid-subtipos" class="grid-productos-ml"></div>
      </div>
    </div>

    <!-- VISTA 3: CATEGOR√çAS -->
    <div id="vista-categorias" class="vista">
      <div class="container mt-3">
        <nav class="breadcrumb-vista">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="#" onclick="volverAInicio(); return false;">INICIO</a></li>
            <li class="breadcrumb-item"><a href="#" id="breadcrumb-tipo-link"></a></li>
            <li class="breadcrumb-item active" id="breadcrumb-subtipo"></li>
          </ol>
        </nav>
        
        <h1 class="h4 fw-bold mb-3" id="titulo-categorias">Categor√≠as</h1>
        <div id="grid-categorias" class="grid-productos-ml"></div>
      </div>
    </div>

    <!-- VISTA 4: PRODUCTOS -->
    <div id="vista-productos" class="vista">
      <div class="container mt-3">
        <nav class="breadcrumb-vista">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="#" onclick="volverAInicio(); return false;">INICIO</a></li>
            <li class="breadcrumb-item"><a href="#" id="breadcrumb-tipo-link-prod"></a></li>
            <li class="breadcrumb-item"><a href="#" id="breadcrumb-subtipo-link"></a></li>
            <li class="breadcrumb-item active" id="breadcrumb-categoria"></li>
          </ol>
        </nav>
        
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h1 class="h4 fw-bold mb-0" id="titulo-productos">Productos</h1>
          <span class="badge bg-primary" id="contador-productos">0 productos</span>
        </div>
        <div id="grid-productos" class="grid-productos-ml"></div>
      </div>
    </div>

    <!-- VISTA 5: TODOS LOS PRODUCTOS -->
    <div id="vista-todos" class="vista">
      <div class="container mt-3">
        <nav class="breadcrumb-vista">
          <ol class="breadcrumb mb-0">
            <li class="breadcrumb-item"><a href="#" onclick="volverAInicio(); return false;">INICIO</a></li>
            <li class="breadcrumb-item active" id="breadcrumb-todos">Todos los productos</li>
          </ol>
        </nav>
        
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h1 class="h4 fw-bold mb-0">üõçÔ∏è Todos los productos</h1>
          <div class="d-flex align-items-center gap-2">
            <span class="badge bg-primary" id="contador-todos">0 productos</span>
          </div>
        </div>
               
        <!-- Grid de productos -->
        <div id="grid-todos" class="grid-productos-ml"></div>
        
        <!-- Spinner para scroll infinito -->
        <div id="cargando-todos" class="text-center py-4 d-none">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando m√°s productos...</span>
          </div>
          <p class="text-muted mt-2">Cargando m√°s productos...</p>
        </div>
        
        <!-- Mensaje de no hay resultados -->
        <div id="sin-resultados-todos" class="text-center py-5 d-none">
          <i class="bi bi-search fs-1 text-muted"></i>
          <h5 class="mt-3">No se encontraron productos</h5>
          <p class="text-muted">Intenta con otros filtros de b√∫squeda</p>
        </div>
        
        <!-- Bot√≥n para ver m√°s -->
<div id="btn-ver-mas-container" class="text-center mt-3 d-none">
  <button id="btn-ver-mas" class="btn btn-outline-primary" onclick="cargarMasProductosScroll()">
    <i class="bi bi-arrow-down"></i> Ver m√°s productos
  </button>
</div>
      </div>
    </div>
  </main>

  <!-- CARRITO OFFCANVAS -->
  <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasCarrito">
    <div class="offcanvas-header border-bottom">
      <h4 class="offcanvas-title fw-bold">üõí Tu Carrito</h4>
      <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
    </div>
    <div class="offcanvas-body" id="carrito-contenido">
      <div class="text-center text-muted py-4">
        <i class="bi bi-bag-x fs-1"></i>
        <p class="mt-2">Tu carrito est√° vac√≠o</p>
      </div>
    </div>
    <div class="offcanvas-footer p-3 border-top">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <span class="fw-bold">Subtotal:</span>
        <span id="subtotal" class="fw-bold fs-5 text-primary">$0</span>
      </div>
      <button class="btn btn-gradient px-4 py-2 rounded-pill fw-bold" onclick="abrirFormularioPedido()">
        ‚ú®Continuar compra‚ú®
      </button>
    </div>
  </div>

  <!-- BOT√ìN CARRITO FLOTANTE -->
  <a href="#" class="btn-carrito-flotante d-none d-md-flex" data-bs-toggle="offcanvas" data-bs-target="#offcanvasCarrito">
    <i class="bi bi-bag-heart fs-4"></i>
    <span id="contador-carrito" class="contador-carrito">0</span>
  </a>

  <!-- ‚úÖ FOOTER -->
  <footer class="footer mt-0" id="footer-container">
    <div class="text-center py-4">
      <div class="spinner-border spinner-border-sm text-primary"></div>
      <p class="mt-1 small text-muted">Cargando informaci√≥n...</p>
    </div>
  </footer>

  <!-- ‚úÖ BARRA INFERIOR MOBILE FIJADA -->
  <nav class="navbar fixed-bottom bg-white border-top d-md-none py-2" style="z-index: 1030;">
    <div class="container-fluid">
      <div class="d-flex justify-content-around w-100">
        <a href="#" class="text-center text-decoration-none text-primary" onclick="volverAInicio(); return false;">
          <i class="bi bi-house-fill fs-5"></i>
          <div class="small">Inicio</div>
        </a>
        <a href="PROMOS.HTML" class="text-center text-decoration-none text-dark">
          <i class="bi bi-percent fs-5"></i>
          <div class="small">Ofertas</div>
        </a>
        <a href="#" class="text-center text-decoration-none position-relative"
           data-bs-toggle="offcanvas" data-bs-target="#offcanvasCarrito">
          <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" 
               style="width: 50px; height: 50px; margin-top: -8px;">
            <i class="bi bi-bag-heart fs-5 text-white"></i>
          </div>
          <span id="contador-carrito-mobile" class="position-absolute top-0 start-100 translate-middle badge bg-danger rounded-pill" style="font-size: 0.6rem;">0</span>
          <div class="small mt-1">Carrito</div>
        </a>
        <a href="https://wa.me/573006498710?text=¬°Hola!%20Me%20interesan%20sus%20productos%20de%20Anmago%20Store" 
           class="text-center text-decoration-none text-success"
           target="_blank">
          <i class="bi bi-whatsapp fs-5"></i>
          <div class="small">Chat</div>
        </a>
        <a href="modalformulario.html" class="text-center text-decoration-none text-dark">
          <i class="bi bi-person fs-5"></i>
          <div class="small">Cuenta</div>
        </a>
      </div>
    </div>
  </nav>

  <!-- SCRIPTS EXTERNOS CON DEFER -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  
  <!-- Scripts con orden optimizado -->
<script>
// ==============================================
// MEN√ö HAMBURGUESA AUT√ìNOMO - NO DEPENDE DE APP.JS
// ==============================================

// Variable para el cat√°logo del men√∫
let catalogoMenuHamburguesa = [];

// Funci√≥n para cerrar el men√∫
function cerrarMenu() {
    const offcanvas = bootstrap?.Offcanvas?.getInstance(document.getElementById('menuLateral'));
    if (offcanvas) {
        offcanvas.hide();
    }
}

// üéØ FUNCI√ìN PRINCIPAL: Cargar categor√≠as en el men√∫ hamburguesa
async function cargarCategoriasMenuHamburguesa() {
    console.log('üçî Cargando categor√≠as para men√∫ hamburguesa...');
    
    const contenedor = document.getElementById('menu-categorias-dinamico');
    if (!contenedor) {
        console.error('‚ùå No se encontr√≥ #menu-categorias-dinamico');
        return;
    }
    
    // Mostrar loading
    contenedor.innerHTML = `
        <div class="text-center py-3">
            <div class="spinner-border spinner-border-sm text-primary"></div>
            <p class="mt-2 small text-muted">Cargando categor√≠as...</p>
        </div>
    `;
    
    try {
        // 1. INTENTAR USAR productosGlobal de app.js si ya est√° cargado
        if (window.productosGlobal && Array.isArray(window.productosGlobal) && window.productosGlobal.length > 0) {
            console.log('‚úÖ Usando productosGlobal de app.js');
            catalogoMenuHamburguesa = window.productosGlobal;
            mostrarCategoriasEnMenu();
            return;
        }
        
        // 2. SI NO, CARGAR EL CAT√ÅLOGO DIRECTAMENTE
        console.log('üì¶ Cargando cat√°logo directamente para men√∫...');
        const url = "https://raw.githubusercontent.com/anmagoS/anmago.store/main/catalogo.json?t=" + Date.now();
        const respuesta = await fetch(url);
        const catalogo = await respuesta.json();
        
        if (!Array.isArray(catalogo) || catalogo.length === 0) {
            throw new Error('Cat√°logo vac√≠o o inv√°lido');
        }
        
        catalogoMenuHamburguesa = catalogo;
        console.log(`‚úÖ Cat√°logo cargado: ${catalogo.length} productos`);
        
        // Mostrar las categor√≠as
        mostrarCategoriasEnMenu();
        
    } catch (error) {
        console.error('‚ùå Error cargando categor√≠as:', error);
        
        const contenedor = document.getElementById('menu-categorias-dinamico');
        if (contenedor) {
            contenedor.innerHTML = `
                <div class="alert alert-warning small py-2">
                    <i class="bi bi-exclamation-triangle me-1"></i>
                    No se pudieron cargar las categor√≠as
                    <button class="btn btn-sm btn-outline-primary mt-1 d-block w-100" 
                            onclick="cargarCategoriasMenuHamburguesa()">
                        <i class="bi bi-arrow-clockwise"></i> Reintentar
                    </button>
                </div>
            `;
        }
    }
}

// üéØ FUNCI√ìN que muestra las categor√≠as en el men√∫
function mostrarCategoriasEnMenu() {
    const contenedor = document.getElementById('menu-categorias-dinamico');
    if (!contenedor) return;
    
    if (!catalogoMenuHamburguesa || catalogoMenuHamburguesa.length === 0) {
        contenedor.innerHTML = '<p class="small text-muted">No hay productos disponibles</p>';
        return;
    }
    
    // Extraer tipos √∫nicos del cat√°logo
    const tiposUnicos = ['TODOS', ...new Set(catalogoMenuHamburguesa.map(p => p.tipo).filter(Boolean))];
    
    console.log(`üìÇ Tipos √∫nicos encontrados: ${tiposUnicos.length - 1}`, tiposUnicos);
    
    if (tiposUnicos.length === 1) { // Solo "TODOS"
        contenedor.innerHTML = '<p class="small text-muted">No se encontraron categor√≠as</p>';
        return;
    }
    
    // Crear HTML del men√∫
    let html = '<p class="small text-muted mb-2"><i class="bi bi-list-ul me-1"></i> Categor√≠as principales</p>';
    html += '<div class="d-flex flex-column gap-2">';
    
    // Opci√≥n "TODOS LOS PRODUCTOS"
    const todosCount = catalogoMenuHamburguesa.length;
    html += `
        <a href="#" class="nav-link categoria-menu-item d-flex justify-content-between align-items-center py-2 px-3 rounded"
           onclick="irATodosLosProductos(); cerrarMenu(); return false;">
            <div class="d-flex align-items-center">
                <i class="bi bi-grid-fill me-2"></i>
                <span>TODOS LOS PRODUCTOS</span>
            </div>
            <span class="badge bg-primary rounded-pill">${todosCount}</span>
        </a>
    `;
    
    // Cada categor√≠a/tipo
    tiposUnicos.slice(1).forEach(tipo => {
        const count = catalogoMenuHamburguesa.filter(p => p.tipo === tipo).length;
        
        html += `
            <a href="#" class="nav-link categoria-menu-item d-flex justify-content-between align-items-center py-2 px-3 rounded"
               onclick="irACategoria('${tipo}'); cerrarMenu(); return false;">
                <div class="d-flex align-items-center">
                    <i class="bi bi-folder me-2"></i>
                    <span>${tipo}</span>
                </div>
                <span class="badge bg-primary rounded-pill">${count}</span>
            </a>
        `;
    });
    
    html += '</div>';
    contenedor.innerHTML = html;
    
    console.log(`‚úÖ Men√∫ hamburguesa cargado: ${tiposUnicos.length - 1} categor√≠as`);
}

// üéØ FUNCIONES DE NAVEGACI√ìN (compatibles con app.js)
function irATodosLosProductos() {
    console.log('üì¶ Navegando a: TODOS LOS PRODUCTOS');
    
    // Si app.js est√° disponible, usar su funci√≥n
    if (typeof window.mostrarTodosLosProductosCompleto === 'function') {
        window.mostrarTodosLosProductosCompleto();
    } else {
        // Fallback: redirigir a index con par√°metro
        window.location.href = 'index.html?tipo=TODOS';
    }
}

function irACategoria(tipo) {
    console.log('üìÅ Navegando a categor√≠a:', tipo);
    
    // Si app.js est√° disponible, usar su funci√≥n
    if (typeof window.cargarPorTipo === 'function') {
        window.cargarPorTipo(tipo);
    } else {
        // Fallback: redirigir a index con par√°metro
        window.location.href = `index.html?tipo=${encodeURIComponent(tipo)}`;
    }
}

// üéØ Funci√≥n placeholder para volver a inicio
function volverAInicio() {
    console.log('üè† Volviendo al inicio desde men√∫');
    
    // Si app.js est√° disponible, usar su funci√≥n
    if (typeof window.volverAInicio === 'function') {
        window.volverAInicio();
    } else {
        // Fallback simple
        const vistaInicio = document.getElementById('vista-inicio');
        const otrasVistas = document.querySelectorAll('.vista:not(#vista-inicio)');
        
        if (vistaInicio) {
            vistaInicio.classList.add('vista-activa');
            otrasVistas.forEach(vista => vista.classList.remove('vista-activa'));
        }
        
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

// üéØ INICIALIZACI√ìN CUANDO EL DOM EST√Å LISTO
document.addEventListener('DOMContentLoaded', function() {
    console.log('üöÄ DOM cargado, configurando men√∫ hamburguesa...');
    
    // Cargar categor√≠as despu√©s de un breve delay
    setTimeout(() => {
        cargarCategoriasMenuHamburguesa();
    }, 800);
    
    // Tambi√©n cargar cuando se abra el men√∫ (por si acaso)
    const menuLateral = document.getElementById('menuLateral');
    if (menuLateral) {
        menuLateral.addEventListener('show.bs.offcanvas', function() {
            console.log('üéØ Men√∫ hamburguesa abierto, verificando categor√≠as...');
            
            // Verificar si ya hay categor√≠as cargadas
            const contenedor = document.getElementById('menu-categorias-dinamico');
            if (contenedor && !contenedor.querySelector('.categoria-menu-item')) {
                console.log('üîÑ No hay categor√≠as, recargando...');
                cargarCategoriasMenuHamburguesa();
            }
        });
    }
});

// üéØ ESCUCHAR CUANDO APP.JS TERMINE DE CARGAR
window.addEventListener('appJSListo', function() {
    console.log('üéØ Evento appJSListo recibido');
    
    // Actualizar el cat√°logo con los datos de app.js
    if (window.productosGlobal && Array.isArray(window.productosGlobal)) {
        catalogoMenuHamburguesa = window.productosGlobal;
        
        // Actualizar el men√∫ si ya est√° cargado
        const contenedor = document.getElementById('menu-categorias-dinamico');
        if (contenedor && contenedor.querySelector('.categoria-menu-item')) {
            console.log('üîÑ Actualizando men√∫ con datos de app.js');
            mostrarCategoriasEnMenu();
        }
    }
});

// üéØ FORZAR CARGA DESPU√âS DE 3 SEGUNDOS (fallback)
setTimeout(() => {
    const contenedor = document.getElementById('menu-categorias-dinamico');
    if (contenedor && (contenedor.innerHTML.includes('Cargando') || 
                      contenedor.innerHTML.includes('No se pudieron'))) {
        console.log('‚ö†Ô∏è Fallback despu√©s de 3s, recargando men√∫...');
        cargarCategoriasMenuHamburguesa();
    }
}, 3000);
</script>
  
  <!-- Tus scripts principales -->
  <script src="app.js?v=20251116" defer></script>
  <script src="carrito.js?v=20251116" defer></script>
  <script src="buscador.js?v=20251115" defer></script>

  <!-- ====== CARGAR FOOTER DIN√ÅMICAMENTE ====== -->
  <script>
    async function cargarFooter() {
      try {
        const respuesta = await fetch('footer.html?v=' + Date.now());
        const htmlFooter = await respuesta.text();
        const contenedor = document.getElementById('footer-container');
        if (contenedor) {
          contenedor.innerHTML = htmlFooter;
        }
      } catch (error) {
        const contenedor = document.getElementById('footer-container');
        if (contenedor) {
          contenedor.innerHTML = `
            <div class="container text-center py-3">
              <p class="text-muted mb-1">&copy; 2025 Anmago Store</p>
              <p class="small text-muted">anmagostore@gmail.com</p>
            </div>
          `;
        }
      }
    }
    
    document.addEventListener('DOMContentLoaded', cargarFooter);
  </script>

  <!-- SCRIPT DEL CARRUSEL OPTIMIZADO -->
  <script>
    // Esperar a que se cargue el contenido principal
    document.addEventListener('DOMContentLoaded', function() {
      setTimeout(() => {
        cargarCarruselSincronizado();
      }, 500);
    });

    const INDEX_PROMOS_CONFIG = {
        productosPorBloque: 8,
        horasPorBloque: 6,
        indiceBloqueActual: 0
    };

    let INDEX_productosEnPromocion = [];

    async function cargarCarruselSincronizado() {
        try {
            await INDEX_cargarCatalogo();
            
            if (INDEX_productosEnPromocion.length === 0) {
                mostrarRespaldoCarrusel();
                return;
            }
            
            INDEX_calcularBloqueActual();
            const productosBloque = INDEX_obtenerProductosDelBloqueActual();
            const productosParaCarrusel = productosBloque.slice(0, 8);
            
            INDEX_mostrarCarrusel(productosParaCarrusel);
            INDEX_iniciarTemporizador();
            
        } catch (error) {
            mostrarRespaldoCarrusel();
        }
    }

    async function INDEX_cargarCatalogo() {
        try {
            const fuentes = [
                "https://raw.githubusercontent.com/anmagoS/anmago.store/main/catalogo.json",
                "catalogo.json"
            ];
            
            let productos = [];
            
            for (const fuente of fuentes) {
                try {
                    const res = await fetch(fuente);
                    if (!res.ok) continue;
                    productos = await res.json();
                    break;
                } catch (error) {
                    continue;
                }
            }
            
            if (productos.length === 0) {
                throw new Error('No se pudo cargar el cat√°logo');
            }
            
            INDEX_productosEnPromocion = productos.filter(producto => {
                if (!producto) return false;
                const promo = producto.promo;
                const tienePromo = promo === "s√≠" || promo === true || promo === "true";
                const tieneImagen = producto.imagen || (producto.imagenes && producto.imagenes.length > 0);
                const tieneNombre = producto.producto && producto.producto.trim().length > 0;
                return tienePromo && tieneImagen && tieneNombre;
            });
            
        } catch (error) {
            throw error;
        }
    }

    function INDEX_calcularBloqueActual() {
        if (INDEX_productosEnPromocion.length === 0) {
            INDEX_PROMOS_CONFIG.indiceBloqueActual = 0;
            return 0;
        }
        
        const ahora = new Date();
        const horasDesdeMedianoche = ahora.getHours() + (ahora.getMinutes() / 60);
        const bloquePorHora = Math.floor(horasDesdeMedianoche / INDEX_PROMOS_CONFIG.horasPorBloque);
        
        const fechaBase = new Date(2024, 0, 1);
        const diasDesdeBase = Math.floor((ahora - fechaBase) / (1000 * 60 * 60 * 24));
        
        const bloquesPorDia = 24 / INDEX_PROMOS_CONFIG.horasPorBloque;
        const totalBloquesHastaAhora = (diasDesdeBase * bloquesPorDia) + bloquePorHora;
        
        const gruposCompletos = Math.ceil(INDEX_productosEnPromocion.length / INDEX_PROMOS_CONFIG.productosPorBloque);
        
        if (gruposCompletos === 0) {
            INDEX_PROMOS_CONFIG.indiceBloqueActual = 0;
        } else {
            INDEX_PROMOS_CONFIG.indiceBloqueActual = totalBloquesHastaAhora % gruposCompletos;
        }
        
        return INDEX_PROMOS_CONFIG.indiceBloqueActual;
    }

    function INDEX_obtenerProductosDelBloqueActual() {
        if (!INDEX_productosEnPromocion || INDEX_productosEnPromocion.length === 0) {
            return [];
        }
        
        const inicio = INDEX_PROMOS_CONFIG.indiceBloqueActual * INDEX_PROMOS_CONFIG.productosPorBloque;
        const fin = Math.min(inicio + INDEX_PROMOS_CONFIG.productosPorBloque, INDEX_productosEnPromocion.length);
        
        let productosBloque = INDEX_productosEnPromocion.slice(inicio, fin);
        
        if (productosBloque.length < INDEX_PROMOS_CONFIG.productosPorBloque) {
            const necesarios = INDEX_PROMOS_CONFIG.productosPorBloque - productosBloque.length;
            const adicionales = INDEX_productosEnPromocion.slice(0, necesarios);
            productosBloque = productosBloque.concat(adicionales);
        }
        
        return productosBloque;
    }

    function INDEX_mostrarCarrusel(productos) {
        const contenedor = document.getElementById('carousel-promos-home-contenido');
        if (!contenedor) return;
        
        if (!productos || productos.length === 0) {
            mostrarRespaldoCarrusel();
            return;
        }
        
        let html = '';
        const productosPorSlide = 4;
        
        for (let i = 0; i < productos.length; i += productosPorSlide) {
            const slideProductos = productos.slice(i, i + productosPorSlide);
            const esPrimerSlide = i === 0;
            
            html += `
                <div class="carousel-item ${esPrimerSlide ? 'active' : ''}">
                    <div class="row g-3 justify-content-center">
                        ${slideProductos.map(producto => INDEX_crearCardCarrusel(producto)).join('')}
                    </div>
                </div>
            `;
        }
        
        contenedor.innerHTML = html;
        
        INDEX_iniciarRotacionCarrusel();
    }

    function INDEX_crearCardCarrusel(producto) {
        const precioOriginal = Number(producto.precio) || 0;
        const precioOferta = producto.precioOferta || Math.round(precioOriginal * 0.9);
        const descuento = Math.round((1 - precioOferta / precioOriginal) * 100);
        
        // Obtener imagen
        let imagen = 'https://ik.imagekit.io/mbsk9dati/placeholder-producto.jpg';
        if (producto.imagenes && producto.imagenes.length > 0) {
            const imgPrincipal = producto.imagenes.find(img => img.tipo === "PRINCIPAL");
            imagen = (imgPrincipal && imgPrincipal.url) || producto.imagenes[0].url;
        } else if (producto.imagen) {
            imagen = producto.imagen;
        }
        
          return `
        <div class="col-6 col-md-3">
            <div class="card h-100 border-0 shadow-sm" 
                 onclick="window.location.href='PRODUCTO.HTML?id=${producto.id}'"
                 style="cursor: pointer;">
                <div class="position-relative" style="height: 180px; overflow: hidden;">
                    <img src="${imagen}" 
                         alt="${producto.producto}"
                         class="card-img-top"
                         width="300"
                         height="180"
                         loading="lazy"
                         style="height: 150px; object-fit: contain; width: 100%; background: #f8f9fa; padding: 10px;"
                         onerror="this.src='https://ik.imagekit.io/mbsk9dati/placeholder-producto.jpg?tr=w-300,h-180,fo-auto,q-80'">
                    
                    <div class="position-absolute top-0 start-0 bg-danger text-white px-2 py-1 small">
                        -${descuento}%
                    </div>
                </div>
                
                <div class="card-body p-2 d-flex flex-column justify-content-between" style="height: 120px;">
                    <h6 class="card-title small mb-1 text-truncate">
                        ${producto.producto}
                    </h6>
                    
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <span class="fw-bold text-primary">
                                $${precioOferta.toLocaleString('es-CO')}
                            </span>
                            <br>
                            <small class="text-muted text-decoration-line-through">
                                $${precioOriginal.toLocaleString('es-CO')}
                            </small>
                        </div>
                        
                        <button class="btn btn-sm btn-outline-primary"
                                onclick="event.stopPropagation(); window.location.href='PRODUCTO.HTML?id=${producto.id}'">
                            <i class="bi bi-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
}

    function INDEX_iniciarTemporizador() {
        const elemento = document.getElementById("temporizador-home");
        if (!elemento) return;
        
        function actualizarTiempo() {
            const ahora = new Date();
            const hora = ahora.getHours();
            const minutos = ahora.getMinutes();
            const segundos = ahora.getSeconds();
            
            const horasHastaProximo = 5 - (hora % 6);
            const minutosHasta = 59 - minutos;
            const segundosHasta = 59 - segundos;
            
            elemento.textContent = `‚è∞ Cambia en ${horasHastaProximo}h ${minutosHasta}m ${segundosHasta}s`;
            
            if (horasHastaProximo === 0 && minutosHasta === 0 && segundosHasta <= 5) {
                setTimeout(() => cargarCarruselSincronizado(), 1000);
            }
        }
        
        actualizarTiempo();
        setInterval(actualizarTiempo, 1000);
    }

    function INDEX_iniciarRotacionCarrusel() {
        const carousel = document.getElementById('carousel-promos-home');
        if (!carousel) return;
        
        if (typeof bootstrap !== 'undefined' && bootstrap.Carousel) {
            new bootstrap.Carousel(carousel, {
                interval: 5000,
                wrap: true
            });
        }
    }

    function mostrarRespaldoCarrusel() {
        const contenedor = document.getElementById('carousel-promos-home-contenido');
        if (contenedor) {
            contenedor.innerHTML = `
                <div class="carousel-item active">
                    <div class="text-center py-4">
                        <i class="bi bi-tag text-primary"></i>
                        <p class="mt-2">Promociones especiales</p>
                        <a href="PROMOS.HTML" class="btn btn-sm btn-primary mt-2">
                            Ver todas las ofertas
                        </a>
                    </div>
                </div>
            `;
        }
    }

    window.recargarCarruselSincronizado = cargarCarruselSincronizado;
  </script>
<script>
// Fallback si despu√©s de 3 segundos no se cargaron las categor√≠as
setTimeout(() => {
    const contenedor = document.getElementById('menu-categorias-dinamico');
    if (contenedor && contenedor.innerHTML.includes('Cargando')) {
        console.log('‚ö†Ô∏è Fallback: cargando categor√≠as directamente...');
        
        // Carga directa como √∫ltimo recurso
        fetch("https://raw.githubusercontent.com/anmagoS/anmago.store/main/catalogo.json")
            .then(res => res.json())
            .then(productos => {
                window.productosGlobal = productos;
                cargarCategoriasEnMenuDesdeAppJS();
            })
            .catch(error => {
                contenedor.innerHTML = `
                    <div class="alert alert-danger small py-2">
                        <i class="bi bi-exclamation-triangle"></i>
                        Error cargando categor√≠as
                    </div>
                `;
            });
    }
}, 3000);
</script>
</body>
</html>
