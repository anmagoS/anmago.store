<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro Cliente | Anmago Store</title>
  <meta name="description" content="Completa tu registro de cliente para realizar pedidos en Anmago Store">
    <!-- Preconexiones optimizadas -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <link rel="preconnect" href="https://ik.imagekit.io">
  <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">

  <!-- PWA y favicon -->
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="logo.jpg" type="image/x-icon" />

  <!-- Bootstrap e iconos -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

  <!-- CSS optimizado -->
  <link rel="stylesheet" href="ESTILO.CSS?v=20251115" />
  
  <!-- Estilos adicionales para el feedback -->
  <style>
    /* Estilos para el feedback de validaci√≥n */
    .validacion-contenedor {
      position: relative;
      margin-bottom: 10px;
    }
    
    .validacion-estado {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      display: none;
    }
    
    .validacion-cargando {
      color: #0d6efd;
      animation: pulse 1.5s infinite;
    }
    
    .validacion-exito {
      color: #198754;
    }
    
    .validacion-error {
      color: #dc3545;
    }
    
    @keyframes pulse {
      0% { opacity: 0.4; }
      50% { opacity: 1; }
      100% { opacity: 0.4; }
    }
    
    .spinner-validacion {
      display: inline-block;
      width: 1rem;
      height: 1rem;
      vertical-align: text-bottom;
      border: 0.2em solid currentColor;
      border-right-color: transparent;
      border-radius: 50%;
      animation: spinner-border .75s linear infinite;
    }
    
    .alert-feedback {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      min-width: 300px;
      max-width: 400px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      animation: slideInRight 0.3s ease;
    }
    
    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .campo-deshabilitado {
      opacity: 0.6 !important;
      background-color: #f8f9fa !important;
      cursor: not-allowed !important;
    }
    
    .btn-cargando {
      position: relative;
      color: transparent !important;
    }
    
    .btn-cargando::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 1.2rem;
      height: 1.2rem;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spinner-border .75s linear infinite;
    }
  </style>
</head>
<body>
<header class="header-sticky d-flex justify-content-between align-items-center px-3 py-2">
  <!-- LOGO -->
 <div class="logo">
  <a href="#" onclick="volverAInicio(); event.preventDefault(); event.stopPropagation(); return false;">
    <img
      src="https://ik.imagekit.io/mbsk9dati/logo.jpg?tr=w-48,h-48"
      alt="ANMAGO STORE"
      width="48"
      height="48"
      loading="lazy"
      style="display: block; object-fit: contain; border-radius: 6px; cursor: pointer;"
    />
  </a>
</div>
<div class="container py-4">
    <h1 class="mb-4 text-center">Registro Cliente</h1></a></div>
  

  <!-- BOT√ìN HAMBURGUESA -->
  <button class="navbar-toggler border-0 bg-transparent" type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#menuLateral"
          aria-controls="menuLateral"
          aria-label="Abrir men√∫">
    <i class="bi bi-list fs-1 text-white"></i>
  </button>
</header>

<!-- MEN√ö LATERAL -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="menuLateral" aria-labelledby="menuLateralLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="menuLateralLabel">
      <img src="https://ik.imagekit.io/mbsk9dati/logo.jpg?tr=w-48,h-48" 
           alt="Anmago Store" width="30" height="30" 
           style="border-radius: 4px; margin-right: 10px;">
      Anmago Store
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Cerrar"></button>
  </div>

  <div class="offcanvas-body d-flex flex-column gap-3">
    <!-- Inicio -->
    <a href="#" class="nav-link d-flex align-items-center" onclick="volverAInicio(); cerrarMenu(); return false;">
      <i class="bi bi-house me-2"></i> Inicio
    </a>

    <!-- Promociones -->
    <a href="PROMOS.HTML" class="nav-link d-flex align-items-center" onclick="cerrarMenu();">
      <i class="bi bi-percent me-2"></i> Promociones
    </a>

    <!-- Todos los productos -->
    <a href="#" class="nav-link d-flex align-items-center" onclick="mostrarTodosLosProductosCompleto(); cerrarMenu(); return false;">
      <i class="bi bi-grid-3x3 me-2"></i> Todos los productos
    </a>

    <!-- CATEGOR√çAS DIN√ÅMICAS - SIMPLIFICADO -->
    <div id="menu-categorias-dinamico" class="mt-2">
      <p class="small text-muted mb-2"><i class="bi bi-list-ul me-1"></i> Categor√≠as principales</p>
      
      <!-- Se cargar√°n din√°micamente usando TUS funciones -->
      <div class="text-center py-3">
        <div class="spinner-border spinner-border-sm text-primary"></div>
        <p class="mt-2 small text-muted">Cargando categor√≠as...</p>
      </div>
    </div>

    <!-- Contacto -->
    <a href="modalformulario.html" 
       class="nav-link d-flex align-items-center" onclick="cerrarMenu();">
      <i class="bi bi-person me-2"></i> Mi cuenta
    </a>

    <!-- WhatsApp -->
    <a href="https://wa.me/573006498710?text=¬°Hola!%20Me%20interesan%20sus%20productos%20de%20Anmago%20Store" 
       target="_blank"
       class="nav-link d-flex align-items-center text-success" onclick="cerrarMenu();">
      <i class="bi bi-whatsapp me-2"></i> WhatsApp
    </a>

    <!-- Contacto formulario -->
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSevvlCBgz7L6l2-DecKQLazoswqzf7DRYWOaCq4FtMGOR6D2Q/viewform?usp=header"
       target="_blank"
       class="nav-link d-flex align-items-center" onclick="cerrarMenu();">
      <i class="bi bi-envelope me-2"></i> Contacto
    </a>
  </div>

  <div class="offcanvas-footer border-top p-3">
    <div class="text-center small text-muted">
      <p class="mb-1">anmagostore@gmail.com</p>
      <p class="mb-0">3006498710 - 3115046741</p>
    </div>
  </div>
</div>

<script>
// ==============================================
// HEADER SIMPLIFICADO - USA TUS FUNCIONES EXISTENTES
// ==============================================

// Funci√≥n para cerrar el men√∫
function cerrarMenu() {
  const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('menuLateral'));
  if (offcanvas) {
    offcanvas.hide();
  }
}

// Funci√≥n que se ejecuta cuando tu app.js carga el cat√°logo
function cargarMenuDesdeTuCatalogo() {
  console.log('üîÑ Cargando men√∫ desde tu cat√°logo...');
  
  const contenedor = document.getElementById('menu-categorias-dinamico');
  if (!contenedor) return;
  
  // Verificar si tu cat√°logo est√° listo
  if (!window.catalogoGlobal || !Array.isArray(window.catalogoGlobal) || window.catalogoGlobal.length === 0) {
    console.log('‚è≥ Esperando cat√°logo de tu app.js...');
    return;
  }
  
  const catalogo = window.catalogoGlobal;
  
  // Obtener tipos √∫nicos de TU cat√°logo
  const tiposUnicos = ['TODOS', ...new Set(catalogo.map(p => p.tipo).filter(Boolean))];
  
  if (tiposUnicos.length === 0) {
    contenedor.innerHTML = '<p class="small text-muted">No hay categor√≠as disponibles</p>';
    return;
  }
  
  // Crear HTML simple usando TUS funciones
  let html = '<p class="small text-muted mb-2"><i class="bi bi-list-ul me-1"></i> Categor√≠as principales</p>';
  
  html += '<div class="d-flex flex-column gap-2">';
  
  tiposUnicos.forEach(tipo => {
    const count = tipo === 'TODOS' 
      ? catalogo.length 
      : catalogo.filter(p => p.tipo === tipo).length;
    
    html += `
      <a href="#" class="nav-link categoria-menu-item d-flex justify-content-between align-items-center py-2 px-3 rounded"
         onclick="${tipo === 'TODOS' ? 'mostrarTodosLosProductosCompleto' : `cargarPorTipo('${tipo}')`}; cerrarMenu(); return false;">
        <div class="d-flex align-items-center">
          <i class="bi ${tipo === 'TODOS' ? 'bi-grid-fill' : 'bi-folder'} me-2"></i>
          <span>${tipo}</span>
        </div>
        <span class="badge bg-primary rounded-pill">${count}</span>
      </a>
    `;
  });
  
  html += '</div>';
  
  contenedor.innerHTML = html;
  console.log('‚úÖ Men√∫ cargado con', tiposUnicos.length, 'categor√≠as');
}

// Inicializar cuando el DOM est√© listo
document.addEventListener('DOMContentLoaded', function() {
  console.log('üöÄ Header simplificado cargado');
  
  // Intentar cargar inmediatamente si el cat√°logo ya est√° disponible
  if (window.catalogoGlobal && Array.isArray(window.catalogoGlobal) && window.catalogoGlobal.length > 0) {
    setTimeout(() => cargarMenuDesdeTuCatalogo(), 300);
  }
  
  // Escuchar cuando tu app.js cargue el cat√°logo
  window.addEventListener('catalogoCargado', function() {
    console.log('üéØ Evento catalogoCargado recibido, cargando men√∫...');
    setTimeout(() => cargarMenuDesdeTuCatalogo(), 300);
  });
  
  // Tambi√©n verificar peri√≥dicamente (fallback)
  const intervalo = setInterval(() => {
    if (window.catalogoGlobal && Array.isArray(window.catalogoGlobal) && window.catalogoGlobal.length > 0) {
      cargarMenuDesdeTuCatalogo();
      clearInterval(intervalo);
    }
  }, 1000);
  
  // Timeout
  setTimeout(() => clearInterval(intervalo), 10000);
});
</script>

<style>
/* ===== ESTILOS B√ÅSICOS PARA EL HEADER ===== */

.header-sticky {
  background: linear-gradient(135deg, #1B4557, #2A6A8F);
  color: white;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1030;
  height: 70px;
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.buscador-header {
  border-radius: 20px;
  border: none;
  padding: 0.5rem 1rem;
  font-size: 0.9rem;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  transition: all 0.3s ease;
}

.buscador-header:focus {
  background: white;
  box-shadow: 0 0 0 2px rgba(52, 131, 250, 0.5);
  outline: none;
}

.navbar-toggler {
  padding: 0.25rem;
  margin-left: 0.5rem;
  transition: transform 0.3s ease;
}

.navbar-toggler:hover {
  transform: scale(1.1);
}

/* Offcanvas */
#menuLateral .offcanvas-header {
  background: linear-gradient(135deg, #1B4557, #2A6A8F);
  color: white;
}

#menuLateral .nav-link {
  color: #333;
  padding: 0.75rem 1rem;
  border-radius: 8px;
  transition: all 0.3s ease;
  font-weight: 500;
  display: flex;
  align-items: center;
}

#menuLateral .nav-link:hover {
  background-color: #e9ecef;
  color: #1B4557;
  transform: translateX(5px);
}

.categoria-menu-item {
  border: 1px solid #dee2e6;
  transition: all 0.2s ease;
}

.categoria-menu-item:hover {
  background-color: #1B4557 !important;
  color: white !important;
  border-color: #1B4557;
  transform: translateX(5px);
}

/* Responsive */
@media (max-width: 768px) {
  .header-sticky {
    height: 60px;
    padding: 0.5rem;
  }
  
  .buscador-header {
    font-size: 0.85rem;
    padding: 0.4rem 0.8rem;
  }
  
  #menuLateral .nav-link {
    padding: 0.6rem 0.75rem;
    font-size: 0.9rem;
  }
}
</style>
 
 <!-- BOT√ìN VOLVER AL INICIO (ARRIBA) -->
<div class="container mt-3">
  <button onclick="volverAInicio()" class="btn btn-volver-inicio btn-sm px-3 py-2 rounded-pill">
    <i class="bi bi-arrow-left me-2"></i> üè† Volver al Inicio
  </button>
</div>
  <!-- CONTENIDO PRINCIPAL -->
  <main class="container py-4">
    <h2 class="mb-4 text-center"></h2>
    
    <!-- ESTADO DE VALIDACI√ìN VISIBLE -->
    <div id="estado-validacion" class="alert alert-info text-center mb-4" style="display: none;">
      <div class="d-flex align-items-center justify-content-center">
        <div class="spinner-border spinner-border-sm me-2" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <span id="mensaje-validacion">Validando registro...</span>
      </div>
    </div>

    <form id="formCliente">
      <!-- ‚úÖ CAMPO OCULTO CON NAME PARA GOOGLE SHEETS -->
      <input type="hidden" id="clienteId" name="clienteId">

      <!-- Celular principal CON FEEDBACK -->
      <div class="mb-3 validacion-contenedor">
        <label for="telefonoCliente" class="form-label">Celular</label>
        <div class="position-relative">
          <input type="tel" class="form-control" id="telefonoCliente" name="telefonoCliente" 
                 placeholder="Ej: 3001234567" maxlength="10" required
                 oninput="validarTelefonoEnTiempoReal()">
          <div id="feedback-telefono" class="validacion-estado">
            <span id="icono-telefono"></span>
          </div>
        </div>
        <div class="form-text">Debe comenzar por 3 y tener 10 d√≠gitos.</div>
        <div id="mensaje-telefono" class="form-text mt-1"></div>
      </div>

      <!-- Nombre -->
      <div class="mb-3">
        <label for="nombreCliente" class="form-label">Nombres y Apellidos</label>
        <input type="text" class="form-control campo-deshabilitado" id="nombreCliente" name="nombreCliente" disabled>
      </div>

      <!-- Direcci√≥n Completa -->
      <div class="mb-3">
        <label for="DireccionCompleta" class="form-label">Direcci√≥n Completa</label>
        <textarea id="DireccionCompleta" class="form-control campo-deshabilitado" name="DireccionCompleta" 
                  rows="2" maxlength="200" placeholder="Ej: calle, carrera, avenida, transversal, etc." disabled></textarea>
        <div class="form-text">Recuerda colocar tu direcci√≥n exacta para evitar contratiempos en tu entrega.</div>
      </div>

      <!-- Tipo de Unidad y N√∫mero -->
      <div class="row mb-3">
        <div class="col-md-6">
          <label for="tipoUnidad" class="form-label">Tipo de unidad</label>
          <select id="tipoUnidad" class="form-select campo-deshabilitado" name="tipoUnidad" disabled>
            <option value="">Selecciona</option>
            <option value="Casa">CASA</option>
            <option value="Apartamento">APARTAMENTO</option>
            <option value="Piso">PISO</option>
            <option value="Bodega">BODEGA</option>
            <option value="Interior">INTERIOR</option>
          </select>
        </div>
        <div class="col-md-6">
          <label for="numeroApto" class="form-label">N√∫mero</label>
          <input type="text" class="form-control campo-deshabilitado" id="numeroApto" name="numeroApto" 
                 maxlength="4" inputmode="numeric" pattern="\d{1,4}" title="Solo n√∫meros entre 0 y 9999" disabled>
        </div>
      </div>

      <!-- Barrio -->
      <div class="mb-3">
        <label for="barrio" class="form-label">Barrio (opcional)</label>
        <input type="text" class="form-control campo-deshabilitado" id="barrio" name="barrio" maxlength="50" disabled>
      </div>

      <!-- Observaci√≥n adicional -->
      <div class="mb-3">
        <label for="observacionDireccion" class="form-label">Punto de referencia</label>
        <textarea id="observacionDireccion" class="form-control campo-deshabilitado" name="observacionDireccion" 
                  rows="2" maxlength="200" placeholder="Ej: entrada por porter√≠a, conjunto.., torre, casa color..., etc." disabled></textarea>
      </div>

      <!-- Ciudad con autocompletado -->
      <div class="mb-3 position-relative">
        <label for="ciudadCliente" class="form-label">Ciudad</label>
        <input type="text" id="ciudadCliente" class="form-control campo-deshabilitado" name="ciudadCliente" 
               placeholder="Escribe tu ciudad" autocomplete="off" disabled>
        <ul id="sugerenciasCiudades" class="dropdown-menu w-100 mt-0 z-3"></ul>
      </div>

      <!-- Correo electr√≥nico -->
      <div class="mb-3">
        <label for="emailCliente" class="form-label">Correo electr√≥nico</label>
        <input type="email" class="form-control campo-deshabilitado" id="emailCliente" name="emailCliente" disabled>
      </div>

      <!-- Bot√≥n Enviar -->
      <div class="text-center mt-4">
        <button id="btnEnviarPedido" class="btn btn-secondary px-4 py-2 rounded-pill fw-bold" disabled>
          <i class="bi bi-send"></i>‚ú® Validando registro... ‚ú®
        </button>
        <p id="estado-formulario" class="text-muted small mt-2"></p>
      </div>
    </form>
  </main>

  <!-- SCRIPTS EXTERNOS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- VALIDACIONES B√ÅSICAS CON FEEDBACK MEJORADO -->
  <script>
    // ========== VARIABLES GLOBALES PARA CONTROL ==========
    let datosCargados = false; // Bandera para saber si ya se cargaron los datos
    let telefonoActual = ''; // Guardar el tel√©fono actual
    let validacionEnProgreso = false; // Evitar m√∫ltiples b√∫squedas simult√°neas

    document.addEventListener("DOMContentLoaded", () => {
      console.log("üöÄ HTML cargado - Iniciando validaciones b√°sicas...");
      
      // Mostrar estado de validaci√≥n inicial
      mostrarEstadoValidacion('üîç Esperando n√∫mero de celular...', 'info');
      
      // Validaci√≥n de campos num√©ricos
      const camposNumericos = ["telefonoCliente", "numeroApto"];

      camposNumericos.forEach(id => {
        const campo = document.getElementById(id);
        if (!campo) return;

        campo.addEventListener("input", () => {
          const valor = campo.value;
          if (!/^\d*$/.test(valor)) {
            campo.value = valor.replace(/\D/g, "");
          }
        });
      });

      // Validaci√≥n espec√≠fica de tel√©fono CON FEEDBACK
      const campoTelefono = document.getElementById("telefonoCliente");
      if (campoTelefono) {
        campoTelefono.addEventListener("input", () => {
          const valor = campoTelefono.value.trim();
          const esValido = /^3\d{9}$/.test(valor);

          if (!esValido && valor.length === 10) {
            campoTelefono.classList.add("is-invalid");
            mostrarFeedbackTelefono('‚ùå Tel√©fono inv√°lido. Debe comenzar con 3', 'error');
            datosCargados = false; // Resetear bandera
          } else if (esValido) {
            campoTelefono.classList.remove("is-invalid");
            campoTelefono.classList.add("is-valid");
            mostrarFeedbackTelefono('‚úÖ Tel√©fono v√°lido', 'exito');
          } else {
            campoTelefono.classList.remove("is-invalid", "is-valid");
            mostrarFeedbackTelefono('', 'neutro');
          }
        });
        
        // Enfocar autom√°ticamente el campo de tel√©fono
        campoTelefono.focus();
      }

      // Cargar header
      fetch("HEADER.HTML")
        .then(res => res.text())
        .then(header => {
          document.getElementById("header-container").innerHTML = header;
        })
        .catch(error => {
          console.error("Error cargando header:", error);
        });
    });
    
    // FUNCIONES DE FEEDBACK MEJORADO
    function mostrarEstadoValidacion(mensaje, tipo = 'info') {
      const estadoDiv = document.getElementById('estado-validacion');
      const mensajeSpan = document.getElementById('mensaje-validacion');
      
      if (!estadoDiv || !mensajeSpan) return;
      
      mensajeSpan.textContent = mensaje;
      
      // Cambiar color seg√∫n tipo
      estadoDiv.className = 'alert text-center mb-4';
      switch(tipo) {
        case 'info':
          estadoDiv.classList.add('alert-info');
          break;
        case 'exito':
          estadoDiv.classList.add('alert-success');
          break;
        case 'advertencia':
          estadoDiv.classList.add('alert-warning');
          break;
        case 'error':
          estadoDiv.classList.add('alert-danger');
          break;
      }
      
      estadoDiv.style.display = 'flex';
    }
    
    function ocultarEstadoValidacion() {
      const estadoDiv = document.getElementById('estado-validacion');
      if (estadoDiv) estadoDiv.style.display = 'none';
    }
    
    function mostrarFeedbackTelefono(mensaje, tipo = 'neutro') {
      const feedbackDiv = document.getElementById('feedback-telefono');
      const iconoSpan = document.getElementById('icono-telefono');
      const mensajeDiv = document.getElementById('mensaje-telefono');
      
      if (!feedbackDiv || !iconoSpan || !mensajeDiv) return;
      
      // Mostrar/ocultar feedback visual
      if (tipo === 'neutro' || !mensaje) {
        feedbackDiv.style.display = 'none';
        mensajeDiv.textContent = '';
        return;
      }
      
      feedbackDiv.style.display = 'block';
      mensajeDiv.textContent = mensaje;
      
      // Cambiar icono seg√∫n tipo
      switch(tipo) {
        case 'cargando':
          iconoSpan.innerHTML = '<span class="spinner-validacion"></span>';
          mensajeDiv.className = 'form-text mt-1 text-primary';
          break;
        case 'exito':
          iconoSpan.innerHTML = '<i class="bi bi-check-circle-fill"></i>';
          mensajeDiv.className = 'form-text mt-1 text-success';
          break;
        case 'error':
          iconoSpan.innerHTML = '<i class="bi bi-exclamation-circle-fill"></i>';
          mensajeDiv.className = 'form-text mt-1 text-danger';
          break;
      }
    }
    
    function validarTelefonoEnTiempoReal() {
      const telefono = document.getElementById('telefonoCliente').value.trim();
      
      // ‚ö†Ô∏è EVITAR B√öSQUEDAS M√öLTIPLES CUANDO YA SE CARGARON DATOS
      if (datosCargados && telefono === telefonoActual) {
        console.log('‚úÖ Datos ya cargados, evitando b√∫squeda duplicada');
        return;
      }
      
      // ‚ö†Ô∏è EVITAR B√öSQUEDAS SIMULT√ÅNEAS
      if (validacionEnProgreso) {
        console.log('‚è≥ Validaci√≥n ya en progreso, esperando...');
        return;
      }
      
      // Limpiar estados anteriores
      mostrarFeedbackTelefono('', 'neutro');
      
      // Solo validar si tiene al menos 10 d√≠gitos
      if (telefono.length === 10) {
        if (!/^3\d{9}$/.test(telefono)) {
          mostrarFeedbackTelefono('‚ùå El tel√©fono debe comenzar con 3', 'error');
          deshabilitarFormulario();
          datosCargados = false;
          telefonoActual = '';
          return;
        }
        
        // Verificar si el tel√©fono es diferente al anterior
        if (telefono !== telefonoActual) {
          telefonoActual = telefono;
          datosCargados = false; // Resetear porque es un nuevo tel√©fono
        }
        
        // Mostrar que se est√° validando
        mostrarFeedbackTelefono('üîç Validando registro...', 'cargando');
        mostrarEstadoValidacion('üîç Buscando cliente en el sistema...', 'info');
        validacionEnProgreso = true;
        
        // Simular una peque√±a pausa para que el usuario vea el feedback
        setTimeout(() => {
          // Esta funci√≥n ser√° llamada desde modalformulario.js
          if (typeof validarClienteExistente === 'function') {
            validarClienteExistente(telefono);
          }
          validacionEnProgreso = false;
        }, 800);
      } else if (telefono.length > 0 && telefono.length < 10) {
        mostrarFeedbackTelefono('üì± Ingresa 10 d√≠gitos', 'neutro');
        deshabilitarFormulario();
        datosCargados = false;
        telefonoActual = '';
      } else {
        mostrarFeedbackTelefono('', 'neutro');
        deshabilitarFormulario();
        datosCargados = false;
        telefonoActual = '';
      }
    }
    
    function deshabilitarFormulario() {
      const otrosCampos = document.querySelectorAll('#formCliente input:not(#telefonoCliente), #formCliente textarea, #formCliente select');
      const btnEnviar = document.getElementById('btnEnviarPedido');
      const estadoFormulario = document.getElementById('estado-formulario');
      
      otrosCampos.forEach(campo => {
        campo.disabled = true;
        campo.classList.add('campo-deshabilitado');
      });
      
      if (btnEnviar) {
        btnEnviar.disabled = true;
        btnEnviar.className = 'btn btn-secondary px-4 py-2 rounded-pill fw-bold';
        btnEnviar.innerHTML = '<i class="bi bi-send"></i>‚ú® Validando registro... ‚ú®';
      }
      
      if (estadoFormulario) {
        estadoFormulario.textContent = '‚è≥ Completa el n√∫mero de celular para continuar';
        estadoFormulario.className = 'text-muted small mt-2';
      }
      
      ocultarEstadoValidacion();
    }
    
    function habilitarFormularioParaEdicion(clienteExistente = false, datosCliente = null) {
      const otrosCampos = document.querySelectorAll('#formCliente input:not(#telefonoCliente), #formCliente textarea, #formCliente select');
      const btnEnviar = document.getElementById('btnEnviarPedido');
      const estadoFormulario = document.getElementById('estado-formulario');
      
      otrosCampos.forEach(campo => {
        campo.disabled = false;
        campo.classList.remove('campo-deshabilitado');
      });
      
      if (btnEnviar) {
        btnEnviar.disabled = false;
        btnEnviar.className = 'btn btn-gradient px-4 py-2 rounded-pill fw-bold';
        
        if (clienteExistente) {
          btnEnviar.innerHTML = '<i class="bi bi-check-circle"></i>‚ú® Actualizar datos ‚ú®';
          if (estadoFormulario) {
            estadoFormulario.textContent = '‚úÖ Cliente encontrado. Puedes editar y actualizar tus datos';
            estadoFormulario.className = 'text-success small mt-2';
          }
          mostrarEstadoValidacion('‚úÖ Cliente encontrado. Actualiza tus datos si es necesario', 'exito');
          
          // ‚úÖ MARCAR QUE LOS DATOS YA SE CARGARON
          datosCargados = true;
          
          // Prevenir que se vuelva a buscar si se modifica el tel√©fono
          const campoTelefono = document.getElementById('telefonoCliente');
          if (campoTelefono) {
            campoTelefono.removeEventListener('input', validarTelefonoEnTiempoReal);
            campoTelefono.addEventListener('input', validarTelefonoSiCambia);
          }
          
        } else {
          btnEnviar.innerHTML = '<i class="bi bi-send"></i>‚ú® Registrar nuevo cliente ‚ú®';
          if (estadoFormulario) {
            estadoFormulario.textContent = 'üìù Nuevo cliente. Completa todos los datos para registrarte';
            estadoFormulario.className = 'text-info small mt-2';
          }
          mostrarEstadoValidacion('üìù Nuevo cliente. Completa tus datos para registrarte', 'info');
          
          // ‚úÖ MARCAR QUE LOS DATOS YA SE CARGARON (como nuevo cliente)
          datosCargados = true;
        }
      }
      
      // Ocultar estado despu√©s de 3 segundos
      setTimeout(ocultarEstadoValidacion, 3000);
    }
    
    // ‚ö†Ô∏è FUNCI√ìN ADICIONAL: Solo validar si el tel√©fono cambia completamente
    function validarTelefonoSiCambia() {
      const telefono = document.getElementById('telefonoCliente').value.trim();
      
      // Si el tel√©fono cambia completamente (menos de 10 d√≠gitos o diferente)
      if (telefono.length !== 10 || telefono !== telefonoActual) {
        // Resetear todo y permitir nueva b√∫squeda
        datosCargados = false;
        deshabilitarFormulario();
        
        // Restaurar el evento original
        const campoTelefono = document.getElementById('telefonoCliente');
        campoTelefono.removeEventListener('input', validarTelefonoSiCambia);
        campoTelefono.addEventListener('input', validarTelefonoEnTiempoReal);
        
        // Llamar a la validaci√≥n normal
        validarTelefonoEnTiempoReal();
      }
    }
    
    function mostrarAlertaFeedback(mensaje, tipo = 'info', duracion = 4000) {
      // Eliminar alertas anteriores
      const alertaExistente = document.querySelector('.alert-feedback');
      if (alertaExistente) alertaExistente.remove();
      
      const alerta = document.createElement('div');
      alerta.className = `alert alert-${tipo} alert-dismissible fade show alert-feedback`;
      alerta.innerHTML = `
        <div class="d-flex align-items-center">
          <i class="bi ${getIconoTipo(tipo)} me-2 fs-5"></i>
          <div class="flex-grow-1">${mensaje}</div>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="alert" aria-label="Cerrar"></button>
        </div>
      `;
      
      document.body.appendChild(alerta);
      
      // Auto-eliminar despu√©s del tiempo especificado
      setTimeout(() => {
        if (alerta.parentNode) {
          alerta.remove();
        }
      }, duracion);
    }
    
    function getIconoTipo(tipo) {
      switch(tipo) {
        case 'success': return 'bi-check-circle';
        case 'danger': return 'bi-exclamation-triangle';
        case 'warning': return 'bi-info-circle';
        default: return 'bi-info-circle';
      }
    }
    // Agrega esta funci√≥n al script existente (despu√©s de las otras funciones)
function finalizarRegistro(success = true, mensaje = '') {
  if (success) {
    // Mostrar mensaje de √©xito
    mostrarAlertaFeedback(mensaje || '‚úÖ Registro completado exitosamente', 'success', 3000);
    
    // Deshabilitar el formulario
    deshabilitarFormulario();
    
    // Cambiar mensaje del bot√≥n
    const btnEnviar = document.getElementById('btnEnviarPedido');
    if (btnEnviar) {
      btnEnviar.disabled = true;
      btnEnviar.innerHTML = '<i class="bi bi-check-circle"></i> ‚úÖ Registro Completado';
      btnEnviar.className = 'btn btn-success px-4 py-2 rounded-pill fw-bold';
    }
    
    // Mostrar estado
    mostrarEstadoValidacion('‚úÖ Registro exitoso. Redirigiendo...', 'success');
    
    // Redirigir despu√©s de 3 segundos
    setTimeout(() => {
      // Opci√≥n 1: Volver al inicio
      window.location.href = 'index.html';
      
      // Opci√≥n 2: Cerrar pesta√±a si se abri√≥ desde otra
      // window.close();
      
      // Opci√≥n 3: Ir a p√°gina de confirmaci√≥n
      // window.location.href = 'registro-exitoso.html';
    }, 3000);
    
  } else {
    // Mostrar error
    mostrarAlertaFeedback(mensaje || '‚ùå Error en el registro', 'danger', 5000);
  }
}

// Funci√≥n para volver al inicio
function volverAInicio() {
  if (confirm('¬øEst√°s seguro de que quieres salir? Los datos no guardados se perder√°n.')) {
    window.location.href = 'index.html';
  }
}

// Hacerla disponible globalmente
window.finalizarRegistro = finalizarRegistro;
window.volverAInicio = volverAInicio;
    
    // Hacer funciones disponibles globalmente
    window.mostrarEstadoValidacion = mostrarEstadoValidacion;
    window.ocultarEstadoValidacion = ocultarEstadoValidacion;
    window.mostrarFeedbackTelefono = mostrarFeedbackTelefono;
    window.deshabilitarFormulario = deshabilitarFormulario;
    window.habilitarFormularioParaEdicion = habilitarFormularioParaEdicion;
    window.mostrarAlertaFeedback = mostrarAlertaFeedback;
    window.validarTelefonoEnTiempoReal = validarTelefonoEnTiempoReal;
  </script>

  <!-- ‚úÖ SCRIPT PRINCIPAL DEL FORMULARIO UNIFICADO -->
  <script src="modalformulario.js?v=20251116" defer></script>
</body>
  <footer class="footer">
  <div class="footer-container">
    <!-- Primera fila: enlaces, redes y contacto -->
    <div class="footer-main">
      <!-- Enlaces institucionales -->
      <div class="footer-section">
        <h4>Anmago Store</h4>
        <div class="footer-links">
          <a href="index.html">Inicio</a>
          <a href="https://sites.google.com/view/anmagostore/quienes-somos">Nosotros</a>
          <a href="https://sites.google.com/view/anmagostore/politica-de-tratamiento-de-datos">Tratamiento de datos</a>
          <a href="https://sites.google.com/view/anmagostore/politicas-de-envios">Env√≠os</a>
          <a href="modalformulario.html" target="_blank">Contacto</a>
        </div>
      </div>
            <!-- Contacto compacto -->
      <div class="footer-section">
        <h4>Contacto</h4>
        <div class="contacto-compacto">
          <p><strong>Email:</strong> anmagostore@gmail.com</p>
          <p><strong>Celulares:</strong> 3006498710 ‚Äì 3115046741</p>
        </div>
      </div>
      
      <!-- Redes sociales compactas -->
      <div class="footer-section">
        <h4>S√≠guenos</h4>
        <div class="redes-sociales-compactas">
          <a href="https://www.facebook.com/profile.php?id=100092463703154&mibextid=ZbWKwL" target="_blank">
      <img src="https://ik.imagekit.io/mbsk9dati/iconos%20redes/4896d785.IMAGEN.155541.jpg?updatedAt=1761587966118"alt="Icono institucional" width="64" height="64" loading="lazy">
    </a>
    <a href="https://www.youtube.com/channel/UCTrvoIT0-3ZbRuE7inPPxDg" target="_blank">
      <img src="https://ik.imagekit.io/mbsk9dati/iconos%20redes/2a9cda61.IMAGEN.155515.jpg?updatedAt=1761587966369" alt="Icono institucional" width="64" height="64" loading="lazy">
      </a>
    <a href="https://www.tiktok.com/@anmagostore?_t=8g37PtO0Los&_r=1" target="_blank">
      <img src="https://ik.imagekit.io/mbsk9dati/iconos%20redes/1d8aa1ac.IMAGEN.155420.jpg?updatedAt=1761587966443" alt="Icono institucional" width="64" height="64" loading="lazy">
    </a>
    <a href="https://instagram.com/anmagostore?igshid=OGQ5ZDc2ODk2ZA==" target="_blank">
      <img src="https://ik.imagekit.io/mbsk9dati/iconos%20redes/cf840649.IMAGEN.155447.jpg?updatedAt=1761587966410" alt="Icono institucional" width="64" height="64" loading="lazy">
    </a>
    <a href="https://wa.me/573006498710" target="_blank">
      <img src="https://ik.imagekit.io/mbsk9dati/iconos%20redes/9018ebd1.IMAGEN.155401.jpg?updatedAt=1761587966435" alt="Icono institucional" width="64" height="64" loading="lazy">
    </a>
    <a href="https://www.google.com/search?q=anmago+store" target="_blank">
      <img src="https://ik.imagekit.io/mbsk9dati/iconos%20redes/ea6b8532.IMAGEN.155430.jpg?updatedAt=1761587966451" alt="Icono institucional" width="64" height="64" loading="lazy">
    </a>
        </div>
      </div>
    </div>
    
    <!-- Segunda fila: medios de pago y copyright -->
    <div class="footer-secondary">
      <!-- Medios de pago compactos -->
      <div class="medios-pago-compactos">
        <h4>Medios de pago</h4>
        <div class="logos-pago-compactos">
          <img src="https://cdn.worldvectorlogo.com/logos/nequi-2.svg" alt="Nequi">
          <img src="https://cdn.worldvectorlogo.com/logos/daviplata.svg" alt="Daviplata">
          <img src="https://epayco.com/wp-content/uploads/2023/01/epayco_pago_seguro.jpg" alt="ePayco">
        </div>
      </div>
      
      <!-- Copyright -->
      <div class="copyright">
        &copy; 2025 Anmago Store. Todos los derechos reservados.
      </div>
    </div>
  </div>
</footer>
</html>
